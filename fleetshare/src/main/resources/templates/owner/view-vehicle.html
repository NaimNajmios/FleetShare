<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/owner-layout}" th:with="activePage='vehicles', pageTitle='Vehicle Details'">

<head>
    <th:block layout:fragment="extra-css">
        <style>
            .profile-container {
                background: white;
                border-radius: 8px;
                padding: 2rem;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            }

            .profile-header {
                display: flex;
                align-items: center;
                gap: 2rem;
                padding-bottom: 2rem;
                border-bottom: 2px solid #e8ecef;
                margin-bottom: 2rem;
            }

            .vehicle-image-container {
                position: relative;
                width: 200px;
                height: 150px;
                border-radius: 8px;
                overflow: hidden;
                background-color: #f8f9fa;
                display: flex;
                align-items: center;
                justify-content: center;
                border: 1px solid #dee2e6;
            }

            .vehicle-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
            }

            .vehicle-placeholder {
                font-size: 3rem;
                color: #adb5bd;
            }

            .image-controls {
                margin-top: 0.5rem;
                display: none;
                gap: 0.5rem;
                justify-content: center;
            }

            #editMode .image-controls {
                display: flex;
            }

            .profile-info h2 {
                margin: 0 0 0.5rem 0;
                font-size: 1.75rem;
            }

            .profile-info .vehicle-meta {
                color: #6c757d;
                font-size: 1rem;
                margin-bottom: 0.5rem;
            }

            .mode-toggle {
                margin-left: auto;
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .status-badge {
                padding: 0.5rem 1rem;
                border-radius: 20px;
                font-weight: 600;
                font-size: 0.875rem;
            }

            .status-available {
                background-color: #d4edda;
                color: #155724;
            }

            .status-rented {
                background-color: #cce5ff;
                color: #004085;
            }

            .status-maintenance {
                background-color: #fff3cd;
                color: #856404;
            }

            .status-unavailable {
                background-color: #f8d7da;
                color: #721c24;
            }

            .form-section {
                margin-bottom: 2rem;
            }

            .form-section h4 {
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 1px solid #e8ecef;
                color: #2c2e30;
            }

            .form-row {
                display: grid;
                grid-template-columns: repeat(2, 1fr);
                gap: 1.5rem;
                margin-bottom: 1.5rem;
            }

            .form-group {
                display: flex;
                flex-direction: column;
            }

            .form-group label {
                font-weight: 600;
                margin-bottom: 0.5rem;
                color: #495057;
            }

            .form-control {
                padding: 0.75rem;
                border: 1px solid #ced4da;
                border-radius: 0.25rem;
                font-size: 1rem;
            }

            .form-control-plaintext {
                padding: 0.75rem;
                background: #f8f9fa;
                border: 1px solid #e9ecef;
                border-radius: 0.25rem;
                color: #495057;
            }

            .manage-rate-btn {
                display: flex;
                align-items: center;
                justify-content: space-between;
                width: 100%;
                text-align: left;
                background-color: #f8f9fa;
                border: 1px solid #ced4da;
                color: #495057;
            }

            .manage-rate-btn:hover {
                background-color: #e2e6ea;
            }

            .form-control:disabled,
            .form-control[readonly] {
                background-color: #e9ecef;
                opacity: 1;
            }

            .action-buttons {
                display: flex;
                justify-content: flex-end;
                gap: 1rem;
                padding-top: 2rem;
                border-top: 2px solid #e8ecef;
            }

            /* View Mode: Hide edit controls */
            #viewMode .form-control,
            #viewMode .form-select {
                background: #f8f9fa;
                border-color: #e9ecef;
                pointer-events: none;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }

            #viewMode .manage-rate-btn {
                pointer-events: none;
                background: #f8f9fa;
                border-color: #e9ecef;
            }

            #viewMode .manage-rate-icon {
                display: none;
            }

            #viewMode .edit-actions {
                display: none;
            }

            #viewMode .view-actions {
                display: flex;
            }

            /* Edit Mode: Show editable fields */
            #editMode .form-control,
            #editMode .form-select {
                background: white;
                border-color: #ced4da;
            }

            #editMode .manage-rate-btn {
                background: white;
                border-color: #ced4da;
                cursor: pointer;
            }

            #editMode .edit-actions {
                display: flex;
            }

            #editMode .view-actions {
                display: none;
            }

            @media (max-width: 768px) {
                .form-row {
                    grid-template-columns: 1fr;
                }

                .profile-header {
                    flex-direction: column;
                    text-align: center;
                }

                .mode-toggle {
                    margin-left: 0;
                }
            }
        </style>
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <div class="row">
            <div class="col-md-12 grid-margin">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h3 class="font-weight-bold">Vehicle Details</h3>
                        <h6 class="font-weight-normal mb-0">View and manage vehicle specifications</h6>
                    </div>
                    <a th:href="@{/owner/vehicles}" class="btn btn-outline-secondary">
                        <i class="mdi mdi-arrow-left"></i> Back to Vehicles
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <div class="profile-container" id="viewMode">
                            <!-- Vehicle Header -->
                            <div class="profile-header">
                                <div>
                                    <div class="vehicle-image-container">
                                        <img th:if="${vehicle.vehicleImageUrl}" th:src="${vehicle.vehicleImageUrl}"
                                            class="vehicle-image" alt="Vehicle Image">
                                        <i th:unless="${vehicle.vehicleImageUrl}"
                                            class="mdi mdi-car vehicle-placeholder"></i>
                                    </div>
                                    <div class="image-controls">
                                        <button class="btn btn-sm btn-outline-danger">Change</button>
                                        <button class="btn btn-sm btn-secondary">Reset</button>
                                    </div>
                                </div>

                                <div class="profile-info">
                                    <h2 th:text="${vehicle.brand + ' ' + vehicle.model}">Vehicle Name</h2>
                                    <p class="vehicle-meta" th:text="${vehicle.registrationNo}">Registration</p>

                                    <span class="status-badge"
                                        th:classappend="${'status-' + #strings.toLowerCase(vehicle.status)}"
                                        th:text="${vehicle.status}">
                                        AVAILABLE
                                    </span>
                                </div>
                                <div class="mode-toggle">
                                    <a th:href="@{/owner/maintenance/vehicle/{id}(id=${vehicle.vehicleId})}"
                                        class="btn btn-outline-info view-actions">
                                        <i class="mdi mdi-wrench"></i> Maintenance History
                                    </a>
                                    <button id="editBtn" class="btn btn-primary view-actions">
                                        <i class="mdi mdi-pencil"></i> Edit Vehicle
                                    </button>
                                </div>
                            </div>

                            <!-- Vehicle Specifications -->
                            <div class="form-section">
                                <h4>Vehicle Specifications</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Brand</label>
                                        <input type="text" class="form-control" th:value="${vehicle.brand}" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>Model</label>
                                        <input type="text" class="form-control" th:value="${vehicle.model}" readonly>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Manufacturing Year</label>
                                        <input type="number" class="form-control"
                                            th:value="${vehicle.manufacturingYear}" readonly>
                                    </div>
                                    <div class="form-group">
                                        <label>Registration No.</label>
                                        <input type="text" class="form-control" th:value="${vehicle.registrationNo}"
                                            readonly>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Category</label>
                                        <select class="form-control form-select" disabled>
                                            <option th:selected="${vehicle.category == 'Sedan'}" value="Sedan">Sedan
                                            </option>
                                            <option th:selected="${vehicle.category == 'SUV'}" value="SUV">SUV</option>
                                            <option th:selected="${vehicle.category == 'MPV'}" value="MPV">MPV</option>
                                            <option th:selected="${vehicle.category == 'Hatchback'}" value="Hatchback">
                                                Hatchback</option>
                                            <option th:selected="${vehicle.category == 'Luxury'}" value="Luxury">Luxury
                                            </option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Mileage (km)</label>
                                        <input type="number" class="form-control" th:value="${vehicle.mileage}"
                                            readonly>
                                    </div>
                                </div>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Fuel Type</label>
                                        <select class="form-control form-select" disabled>
                                            <option th:selected="${vehicle.fuelType == 'Petrol'}" value="Petrol">Petrol
                                            </option>
                                            <option th:selected="${vehicle.fuelType == 'Diesel'}" value="Diesel">Diesel
                                            </option>
                                            <option th:selected="${vehicle.fuelType == 'Hybrid'}" value="Hybrid">Hybrid
                                            </option>
                                            <option th:selected="${vehicle.fuelType == 'Electric'}" value="Electric">
                                                Electric</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Transmission</label>
                                        <select class="form-control form-select" disabled>
                                            <option th:selected="${vehicle.transmissionType == 'Automatic'}"
                                                value="Automatic">Automatic</option>
                                            <option th:selected="${vehicle.transmissionType == 'Manual'}"
                                                value="Manual">Manual</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Status & Rate -->
                            <div class="form-section">
                                <h4>Status & Rate</h4>
                                <div class="form-row">
                                    <div class="form-group">
                                        <label>Availability Status</label>
                                        <select class="form-control form-select" disabled>
                                            <option th:selected="${vehicle.status == 'AVAILABLE'}" value="AVAILABLE">
                                                Available</option>
                                            <option th:selected="${vehicle.status == 'RENTED'}" value="RENTED">Rented
                                            </option>
                                            <option th:selected="${vehicle.status == 'MAINTENANCE'}"
                                                value="MAINTENANCE">Maintenance</option>
                                            <option th:selected="${vehicle.status == 'UNAVAILABLE'}"
                                                value="UNAVAILABLE">Unavailable</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Rate Per Day (RM)</label>
                                        <button class="btn manage-rate-btn">
                                            <span th:text="${'RM ' + vehicle.ratePerDay}">RM 100.00</span>
                                            <i class="mdi mdi-cog manage-rate-icon"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="action-buttons">
                                <div class="edit-actions">
                                    <button id="cancelBtn" class="btn btn-secondary">Cancel</button>
                                    <button id="saveBtn" class="btn btn-danger">Update Vehicle</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block layout:fragment="extra-js">
        <script>
            // Toggle between view and edit modes
            const container = document.querySelector('.profile-container');
            const editBtn = document.getElementById('editBtn');
            const cancelBtn = document.getElementById('cancelBtn');
            const saveBtn = document.getElementById('saveBtn');

            editBtn.addEventListener('click', function () {
                container.id = 'editMode';
                // Enable form controls
                document.querySelectorAll('.form-control, .form-select').forEach(input => {
                    input.removeAttribute('readonly');
                    input.removeAttribute('disabled');
                });
            });

            cancelBtn.addEventListener('click', function () {
                container.id = 'viewMode';
                // Disable form controls
                document.querySelectorAll('.form-control, .form-select').forEach(input => {
                    input.setAttribute('readonly', 'readonly');
                    input.setAttribute('disabled', 'disabled');
                });
                // Reload page to reset changes
                location.reload();
            });

            saveBtn.addEventListener('click', function () {
                // TODO: Implement save functionality
                alert('Update functionality will be implemented soon!');
            });
        </script>
    </th:block>
</body>

</html>
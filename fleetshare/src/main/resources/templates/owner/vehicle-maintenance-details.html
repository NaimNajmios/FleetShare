<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layouts/owner-layout}"
    th:with="activePage='maintenance', pageTitle='Vehicle Maintenance Details'">

<head>
    <th:block layout:fragment="extra-css">
        <style>
            .vehicle-header {
                background: white;
                padding: 1.5rem;
                border-radius: 0.5rem;
                margin-bottom: 1.5rem;
                display: flex;
                align-items: center;
                gap: 2rem;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
            }

            .vehicle-thumbnail {
                width: 120px;
                height: 120px;
                object-fit: cover;
                border-radius: 0.5rem;
                background-color: #f8f9fa;
            }

            .vehicle-info h3 {
                margin-bottom: 0.5rem;
                font-weight: bold;
            }

            .vehicle-info p {
                margin-bottom: 0.25rem;
                color: #6c757d;
            }

            .kpi-card {
                background: white;
                padding: 1.5rem;
                border-radius: 0.5rem;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.05);
                height: 100%;
                display: flex;
                flex-direction: column;
                justify-content: center;
            }

            .kpi-title {
                color: #6c757d;
                font-size: 0.9rem;
                margin-bottom: 0.5rem;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .kpi-value {
                font-size: 1.8rem;
                font-weight: bold;
                color: #333;
            }

            .badge-pill {
                padding-right: 0.6em;
                padding-left: 0.6em;
                border-radius: 10rem;
            }
        </style>
    </th:block>
</head>

<body>
    <div layout:fragment="content">
        <!-- Vehicle Profile Header -->
        <div class="row">
            <div class="col-12">
                <div class="vehicle-header">
                    <img th:src="${vehicle.vehicleImageUrl != null ? vehicle.vehicleImageUrl : '/assets/images/car-placeholder.png'}"
                        alt="Vehicle Thumbnail" class="vehicle-thumbnail">
                    <div class="vehicle-info">
                        <h3 th:text="${vehicle.brand + ' ' + vehicle.model}">Perodua Myvi</h3>
                        <p><strong>Registration No:</strong> <span th:text="${vehicle.registrationNo}">WUX 5815</span>
                        </p>
                        <p><strong>Vehicle ID:</strong> <span th:text="${vehicle.vehicleId}">1</span></p>
                        <p><strong>Owner:</strong> <span th:text="${ownerName}">MetroCity Car Rental</span></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Metrics (KPI Cards) -->
        <div class="row mb-4">
            <div class="col-md-4 grid-margin stretch-card">
                <div class="kpi-card">
                    <div class="kpi-title">Total Maintenance Records</div>
                    <div class="kpi-value" th:text="${totalRecords}">3</div>
                </div>
            </div>
            <div class="col-md-4 grid-margin stretch-card">
                <div class="kpi-card">
                    <div class="kpi-title">Total Maintenance Cost</div>
                    <div class="kpi-value"
                        th:text="${'RM ' + #numbers.formatDecimal(totalCost, 1, 'COMMA', 2, 'POINT')}">RM 1,810.00</div>
                </div>
            </div>
            <div class="col-md-4 grid-margin stretch-card">
                <div class="kpi-card">
                    <div class="kpi-title">Last Maintenance Date</div>
                    <div class="kpi-value"
                        th:text="${lastMaintenanceDate != null ? #temporals.format(lastMaintenanceDate, 'dd/MM/yyyy') : 'N/A'}">
                        17/06/2025</div>
                </div>
            </div>
        </div>

        <!-- Maintenance Records Table -->
        <div class="row">
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4 class="card-title">Maintenance Records</h4>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Date</th>
                                        <th>Description</th>
                                        <th>Cost (RM)</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr th:each="record : ${maintenanceRecords}">
                                        <td th:text="${record.maintenanceId}">1</td>
                                        <td th:text="${#temporals.format(record.maintenanceDate, 'dd/MM/yyyy')}">
                                            17/06/2025</td>
                                        <td th:text="${record.description}">Major Service</td>
                                        <td th:text="${#numbers.formatDecimal(record.cost, 1, 'COMMA', 2, 'POINT')}">
                                            1,200.00</td>
                                        <td>
                                            <span th:if="${record.status == 'COMPLETED'}"
                                                class="badge badge-success badge-pill">Completed</span>
                                            <span th:if="${record.status == 'PENDING'}"
                                                class="badge badge-warning badge-pill">Pending</span>
                                            <span th:if="${record.status == 'IN_PROGRESS'}"
                                                class="badge badge-info badge-pill">In Progress</span>
                                        </td>
                                        <td>
                                            <button class="btn btn-sm btn-warning" title="Mark Pending">
                                                <i class="mdi mdi-undo"></i>
                                            </button>
                                            <button class="btn btn-sm btn-danger" title="Delete">
                                                <i class="mdi mdi-delete"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    <tr th:if="${#lists.isEmpty(maintenanceRecords)}">
                                        <td colspan="6" class="text-center py-4">No maintenance records found for this
                                            vehicle.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

</html>
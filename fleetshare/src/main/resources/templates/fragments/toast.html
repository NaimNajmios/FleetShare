<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="toast">
    <style>
        .toast-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 10000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            pointer-events: none;
        }

        .toast-notification {
            pointer-events: auto;
            min-width: 320px;
            max-width: 420px;
            padding: 16px 20px;
            border-radius: 12px;
            background: white;
            color: #1f2937;
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 8px 10px -6px rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: flex-start;
            gap: 14px;
            opacity: 0;
            transform: translateX(100px);
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            border-left: 5px solid transparent;
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            position: relative;
            overflow: hidden;
        }

        .toast-notification.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-icon {
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 2px;
        }

        .toast-icon i {
            font-size: 1.5rem;
            line-height: 1;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 2px;
            line-height: 1.4;
            color: #111827;
        }

        .toast-message {
            font-size: 0.875rem;
            color: #6b7280;
            line-height: 1.5;
        }

        .toast-close {
            flex-shrink: 0;
            background: transparent;
            border: none;
            color: #9ca3af;
            cursor: pointer;
            padding: 4px;
            margin-top: -4px;
            margin-right: -4px;
            border-radius: 4px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toast-close:hover {
            color: #4b5563;
            background-color: #f3f4f6;
        }

        /* Success Variant */
        .toast-success {
            border-left-color: #10b981;
        }

        .toast-success .toast-icon {
            color: #10b981;
        }

        /* Error Variant */
        .toast-error {
            border-left-color: #ef4444;
        }

        .toast-error .toast-icon {
            color: #ef4444;
        }

        /* Info Variant */
        .toast-info {
            border-left-color: #3b82f6;
        }

        .toast-info .toast-icon {
            color: #3b82f6;
        }

        /* Warning Variant */
        .toast-warning {
            border-left-color: #f59e0b;
        }

        .toast-warning .toast-icon {
            color: #f59e0b;
        }
    </style>

    <div id="toast-container" class="toast-container" aria-live="polite"></div>

    <script th:inline="javascript">
        (function () {
            const Toast = {
                container: document.getElementById('toast-container'),

                show(message, type = 'info', title = '') {
                    if (!this.container) return;

                    let iconClass = 'mdi-information';
                    let defaultTitle = 'Info';

                    switch (type) {
                        case 'success':
                            iconClass = 'mdi-check-circle';
                            defaultTitle = 'Success';
                            break;
                        case 'error':
                            iconClass = 'mdi-alert-circle';
                            defaultTitle = 'Error';
                            break;
                        case 'warning':
                            iconClass = 'mdi-alert';
                            defaultTitle = 'Warning';
                            break;
                    }

                    if (!title) title = defaultTitle;

                    const toast = document.createElement('div');
                    toast.className = `toast-notification toast-${type}`;
                    toast.setAttribute('role', 'alert');

                    toast.innerHTML = `
                        <div class="toast-icon">
                            <i class="mdi ${iconClass}"></i>
                        </div>
                        <div class="toast-content">
                            <div class="toast-title">${title}</div>
                            <div class="toast-message">${message}</div>
                        </div>
                        <button class="toast-close" aria-label="Close">
                            <i class="mdi mdi-close" style="font-size: 1.2rem;"></i>
                        </button>
                    `;

                    const closeBtn = toast.querySelector('.toast-close');
                    if (closeBtn) {
                        closeBtn.addEventListener('click', () => {
                            this.dismiss(toast);
                        });
                    }

                    this.container.appendChild(toast);

                    requestAnimationFrame(() => {
                        toast.classList.add('show');
                    });

                    const duration = type === 'error' ? 6000 : 4000;
                    setTimeout(() => {
                        this.dismiss(toast);
                    }, duration);
                },

                dismiss(toast) {
                    if (!toast) return;
                    toast.classList.remove('show');
                    toast.addEventListener('transitionend', () => {
                        if (toast.parentNode) toast.parentNode.removeChild(toast);
                    });
                }
            };

            window.showToast = (msg, type, title) => Toast.show(msg, type, title);

            document.addEventListener('DOMContentLoaded', function () {
                // Flash Attributes - check if variables exist before using
                /*[# th:if="${successMessage != null}"]*/
                const successMsg = /*[[${successMessage}]]*/ null;
                if (successMsg) Toast.show(successMsg, 'success');
                /*[/]*/

                /*[# th:if="${errorMessage != null}"]*/
                const errorMsg = /*[[${errorMessage}]]*/ null;
                if (errorMsg) Toast.show(errorMsg, 'error');
                /*[/]*/

                /*[# th:if="${infoMessage != null}"]*/
                const infoMsg = /*[[${infoMessage}]]*/ null;
                if (infoMsg) Toast.show(infoMsg, 'info');
                /*[/]*/

                /*[# th:if="${warningMessage != null}"]*/
                const warningMsg = /*[[${warningMessage}]]*/ null;
                if (warningMsg) Toast.show(warningMsg, 'warning');
                /*[/]*/
            });
        })();
    </script>
</th:block>